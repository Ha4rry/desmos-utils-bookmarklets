javascript:(function(){run=true;try{ul = document.querySelectorAll(`ul[role="listbox"]`)[0];lis = ul.querySelectorAll('li')}catch{run=false;alert("This bookmarklet needs to be run in the Saved Graphs menu in Grid view.\n\nOn the calculator, click the folder in the top left to access this, with view controls in the top right of the menu (default is grid view)")};if (run === true){iframeIDs = [];links = {};loaded = 0;for (let i = 0; i < lis.length; i++) {li = lis[i];link = li.querySelector('a').href;iframe = document.createElement('iframe');iframe.src = link;iframe.id = `iframe${i}`;iframeIDs.push(iframe.id);li.replaceWith(iframe);iframe.onload = () => {loaded = loaded + 1};if (i === lis.length - 1) {checkInterval = setInterval(() => {if (loaded === lis.length) {backup();clearInterval(checkInterval)}},1000)}};function backup(){for (let i = 0; i < iframeIDs.length; i++) {iframeID = iframeIDs[i];iwin = document.querySelector(`#${iframeIDs[i]}`).contentWindow;stateJSON=iwin.Calc.getState();stateBlob=new Blob([JSON.stringify(stateJSON)], {type: "application/json"});stateBlobURL=URL.createObjectURL(stateBlob);filename=`${iwin.document.querySelector("#dcg-graph-title-text").innerText}-${Math.floor(Date.now()/1000)}.json`;links[filename] = stateBlobURL;}if (Object.keys(links).length === lis.length) {ulParent = ul.parentElement;ul.remove();physicalLinks = [];for (let [fn, url] of Object.entries(links)) {a = document.createElement('a');a.href=url;a.download=fn;a.innerText=fn;a.style='display:inline-block !important;margin-bottom:2em !important; margin-right:2em !important;border-style:solid !important;padding:1em !important;';ulParent.appendChild(a);physicalLinks.push(a);console.log(a)};if (physicalLinks.length === lis.length) {downloadAll = document.createElement('button');downloadAll.onclick = () => {for (pL of physicalLinks) {pL.click()}};downloadAll.innerText = "Download all at once...";downloadAll.style="display:block !important;margin-bottom:1em !important;font-size:1.5em !important;color:blue !important;background-color:orange !important;";ulParent.prepend(downloadAll);}else{alert("Failed, not all links are present..")}}else{alert("Failed, blob creation incomplete.")}}}})();
